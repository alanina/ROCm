parameters:
- name: repoName
  type: string
  default: ''
- name: eventType
  type: string
  default: ''
- name: azureBuildNumber
  type: string
  default: ''
- name:  githubActionsToken
  type: string
  default: ''

steps:
- task: Bash@3
  name: ghActionsPost
  displayName: Post a request to a github repository with a repository_dispatch workflow
  continueOnError: true
  inputs:
    targetType: inline
    workingDirectory: $(Build.SourcesDirectory) 
    script: |
      curl -X POST \
        -H "Accept: application/vnd.github.everest-preview+json" \
        -H "Authorization: token ${{ parameters.githubActionsToken }}" \
        https://api.github.com/repos/${{ parameters.repoName }}/dispatches \
        -d '{
          "event_type": "${{ parameters.eventType }}",
          "client_payload": {
            "azure-job-id": "${{ parameters.azureBuildNumber }}"
          }
        }'